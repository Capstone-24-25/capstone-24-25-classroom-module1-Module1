"0","# Split the data into training and testing sets"
"0","set.seed(123)"
"0","biomarker_split <- initial_split(biomarker_clean, prop = 0.8)"
"0","train_data <- training(biomarker_split)"
"0","test_data <- testing(biomarker_split)"
"0",""
"0","## Multiple Testing"
"0","test_fn <- function(.df){"
"0","  t_test(.df,"
"0","         formula = level ~ group,"
"0","         order = c('ASD', 'TD'),"
"0","         alternative = 'two-sided',"
"0","         var.equal = F)"
"0","}"
"0",""
"0","ttests_out <- train_data %>%"
"0","  # drop ADOS score"
"0","  select(-ados) %>%"
"0","  # arrange in long format"
"0","  pivot_longer(-group,"
"0","               names_to = 'protein',"
"0","               values_to = 'level') %>%"
"0","  # nest by protein"
"0","  nest(data = c(level, group)) %>%"
"0","  # compute t tests"
"0","  mutate(ttest = map(data, test_fn)) %>%"
"0","  unnest(ttest) %>%"
"0","  # sort by p-value"
"0","  arrange(p_value) %>%"
"0","  # multiple testing correction"
"0","  mutate(m = n(),"
"0","         hm = log(m) + 1/(2*m) - digamma(1),"
"0","         rank = row_number(),"
"0","         p.adj = m*hm*p_value/rank)"
"0",""
"0","# select significant proteins based on adjusted p-value"
"0","proteins_s1 <- ttests_out %>%"
"0","  slice_min(p.adj, n = 10) %>%"
"0","  pull(protein)"
"0",""
"0","## Random Forest "
"0","# store predictors and response separately"
"0","predictors <- train_data %>% "
"0","  select(-c(group, ados))"
"0",""
"0","response <- train_data %>% pull(group) %>% factor()"
"0",""
"0","# fit RF"
"0","set.seed(123)"
"0","rf_out <- randomForest(x = predictors,"
"0","                       y = response,"
"0","                       ntree = 1000,"
"0","                       importance = T)"
"0",""
"0","# check errors "
"0","rf_out$confusion"
"1","   "
"1"," ASD"
"1"," TD"
"1"," class.error"
"1","
ASD"
"1","  39"
"1"," 19"
"1","   0.3275862"
"1","
TD "
"1","  11"
"1"," 54"
"1","   0.1692308"
"1","
"
"0","# compute importance scores"
"0","proteins_s2 <- rf_out$importance %>% "
"0","  as_tibble() %>%"
"0","  mutate(protein = rownames(rf_out$importance)) %>%"
"0","  slice_max(MeanDecreaseGini, n = 10) %>%"
"0","  pull(protein)"
"0",""
"0",""
"0","## Logistic Regression"
"0","# select subset of interest"
"0","proteins_sstar <- intersect(proteins_s1, proteins_s2)"
"0",""
"0","biomarker_sstar <- biomarker_clean %>%"
"0","  select(group, any_of(proteins_sstar)) %>%"
"0","  mutate(class = (group == 'ASD')) %>%"
"0","  select(-group)"
"0",""
"0","# partition into training and test set"
"0","biomarker_split <- biomarker_sstar %>%"
"0","  initial_split(prop = 0.8)"
"0",""
"0","# fit logistic regression model to training set"
"0","fit <- glm(class ~ ., "
"0","           data = training(biomarker_split), "
"0","           family = 'binomial')"
"0",""
"0","# evaluate errors on test set"
"0","class_metrics <- metric_set(sensitivity, "
"0","                            specificity, "
"0","                            accuracy,"
"0","                            roc_auc)"
"0",""
"0","testing(biomarker_split) %>%"
"0","  add_predictions(fit, type = 'response') %>%"
"0","  mutate(est = as.factor(pred > 0.5), tr_c = as.factor(class)) %>%"
"0","  class_metrics(estimate = est,"
"0","              truth = tr_c, pred,"
"0","              event_level = 'second')"
